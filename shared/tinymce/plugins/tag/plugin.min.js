tinymce.PluginManager.add('tag', function(editor, url) {
    editor.addButton('tag', {
        text: 'Tag',
        icon: false,
		tooltip: 'Insert Tag',
        onclick: function() {
            var x = tinymce.activeEditor.selection.getContent({format: 'text'}).trim();
            var y = tinymce.activeEditor.selection.getContent({format: 'text'});
            if(x!=y) s = " "; else s = "";
            if(x) {
                editor.insertContent('<a href="/tag/' + x + '" title="' + x + '">' + x + '</a>' + s);
            } else {
                editor.windowManager.open({
                    title: 'Insert Tag',
                    body: [{type: 'textbox',value: '',name:'keyword',label:'Keyword:'}],
                    onsubmit: function(e) {
                        var t = e.data.keyword;
                        editor.insertContent('<a href="/tag/' + t + '" title="' + t + '">' + t + '</a>');
                    }
                });
            }
        }
    });
});